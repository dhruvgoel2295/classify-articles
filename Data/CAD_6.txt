Computer-Aided Design 70 (2016) 67–77

Contents lists available at ScienceDirect

Computer-Aided Design
journal homepage: www.elsevier.com/locate/cad

A statistical atlas based approach to automated subject-specific FE
modeling✩
Xilu Wang, Xiaoping Qian ∗
Department of Mechanical Engineering, The University of Wisconsin-Madison, Madison, WI 53706, United States

highlights
•
•
•
•

A statistical atlas is constructed to account for shape variations.
Shape correspondence is obtained through the eigenspace search.
Subject-specific FE mesh is obtained from the deformed mesh of the mean shape.
The method is automated and is applicable to shapes with large variations.

article

info

Keywords:
Free-form deformation
Morphing
Statistical shape modeling
Finite element modeling

abstract
Subject-specific modeling is increasingly important in biomechanics simulation. However, how to automatically create high-quality finite element (FE) mesh and how to automatically impose boundary condition are challenging.
This paper presents a statistical atlas based approach for automatic meshing of subject-specific shapes.
In our approach, shape variations among a shape population are explicitly modeled and the correspondence between a given subject-specific shape and the statistical atlas is sought within the ‘‘legal’’ shape
variations. This approach involves three parts: (1) constructing a statistical atlas from a shape population,
including the statistical shape model and the FE model of the mean shape; (2) establishing the correspondence between a given subject shape and the atlas; and (3) deforming the atlas to the subject shape based
on the shape correspondence. Numerical results on 2D hands, 3D femur bones and 3D aorta demonstrate
the effectiveness of the proposed approach.
© 2015 Elsevier Ltd. All rights reserved.

1. Introduction
Biomechanical simulation often involves finite element (FE)
modeling of subject-specific anatomic structures. However, the
task of creating FE meshes such as hex mesh for each subject usually requires manual intervention and can be tedious and time consuming. Such lack of automation in FE modeling and its lengthy
laborious process pose substantial challenges for applications
where FE modeling and analysis need to be done in a short period of time, for example, in clinical setting such as providing surgical guidance during surgery. The ability to automate FE modeling
of subject-specific shapes would lead to a population of subjectspecific models with applications in surgical planning and implant

✩ This paper has been recommended for acceptance by Scott Schaefer and Charlie
C.L. Wang.
∗ Corresponding author.
E-mail address: qian@engr.wisc.edu (X. Qian).

http://dx.doi.org/10.1016/j.cad.2015.07.003
0010-4485/© 2015 Elsevier Ltd. All rights reserved.

design. The goal of this paper is to present an approach that can automatically build subject-specific FE models from a given subjectspecific shape.
In the literature, a common approach to efficient shape modeling or FE modeling of subject-specific shapes is through templatebased deformation. For example, morphing template meshes to
subject-specific shapes has been explored in [1–3]. A mesh morphing approach to conduct statistical models of femurs was studied
in [4]. However, it has not been used to generate subject-specific FE
models. Recently, an atlas based geometry pipeline for constructing three-dimensional cubic Hermite finite element meshes from
tomographic patient image data and deforming the atlas to a second patient has been studied in [5].
The above approaches usually contain two steps: (1) registration of the subject shape [1–4] or image [5] to the template; (2) FE
mesh morphing of the template to the subject with the correspondence obtained in the registration. However, these approaches are
unaware of the specificity of the subject shapes and usually need
to involve a large number of registration parameters and manual

68

X. Wang, X. Qian / Computer-Aided Design 70 (2016) 67–77

Fig. 1. A schematic diagram of the statistical atlas based subject-specific FE
modeling.

specification of a large number of landmarks to ensure proper correspondence between a given shape and the template shape. For
example, in the free-form deformation, as pointed out by [3], the
resolution of the deformation should be approximately the size of
the smallest anatomical structures to be registered, so it requires
a large number of degrees of freedom (thousands) for the accurate
registration of fine structures. This makes the problem complex, inefficient and more importantly, not robust. When a subject shape
deviates significantly from the template shape, a simple deformation based approach, without manual specification of correspondence between the template shape and the given shape, would
fail to generate proper correspondence between the two shapes.
Therefore, the FE mesh and boundary conditions cannot be properly transferred from the template shape to the given shape.
For a certain class of shapes, the shape variations follow some
particular patterns, and the deformations within the class are constrained by a limited number of degrees of freedom. Thus, for the
FE mesh construction of a specific class of subject shapes, we first
learn a prior knowledge of the population through statistical shape
modeling [6] and build a linear space of shapes. Then, instead of
applying a ‘‘free style deformation’’ in the registration, the mean
shape of the population is deformed in the ‘‘shape space’’ to match
the subject-specific shape. In this way the deformation could be
parameterized by just a few number of variables and becomes simple and robust. The generic FE mesh is built upon the mean shape
of the population.
Fig. 1 gives an overview of our approach: the input is the subject
specific shape, the output is the FE mesh of the subject shape.
This mesh construction process is based on the statistical atlas and
contains two steps: (1) boundary correspondence identification
through shape instantiation and projection; (2) FE mesh morphing
by the boundary correspondence.
The statistical atlas contains two parts: the statistical shape
model which determines a linear shape space and the FE mesh
of the mean shape. The statistical shape model is learned from
a population of shapes by principal component analysis, and
includes the mean shape S¯ of the population and the eigen-modes
{Ψi } that capture the variations of the population. Originated at the
mean shape, the eigen-modes together span a linear space of the
shapes and any instance in that space can be instantiated by:


S = S¯ +



w i Ψi ,

i

The contribution of this paper is a new approach that can automatically, efficiently and robustly produce high quality FE meshes
for a given subject-specific shape. To examine the quality of the
proposed approach, we use three measures: the distance between
the instantiated shape and the given shape, the correlation coefficient of normal vectors between the mean shape and the given
shape, and the mesh quality. Numerical examples on 2D hands, 3D
femur bones and 3D aorta demonstrate that the proposed approach
outperforms the simple deformation based approach.
The remainder of this paper is organized as follows. Section 2
introduces the construction of statistical atlas, Sections 3 and
4 cover the two steps of the proposed approach, Section 5
introduces the three measures for our approach. Numerical results
are presented in Section 6. This paper is concluded in Section 7.
2. Constructing statistical atlas
The statistical atlas is constructed to incorporate the prior
knowledge of a specific class of shapes and provide a generic FE
mesh for mesh morphing. The prior knowledge are learned by the
statistical shape modeling of a population of training shapes. The
generic FE mesh is constructed on the population mean whose
overall distance to other instances in the population is minimized.
In this section we briefly introduce the process of statistical atlas construction. A set of training shapes are registered together in
a non-rigid fashion through free-form deformation. In order to ensure good correspondence across the shape population, landmarks
are specified. A mean shape model and shape variations across a
population of shapes are then obtained through generalized Procrustes alignment (GPA) [7] and principal component analysis of
the shape population. The mean shape is then discretized into FE
meshes (triangular or hexagonal).
In the following subsections we will use the 40 hand shapes
in [6] as examples to demonstrate our method.
2.1. Pairwise shape registration by free-form deformation
Given the training set of ns number of shapes S =

. . . , Sns , in order to correctly calculate the population mean
and model the shape variations, correspondences between these
shapes must be built. Based on such correspondences, we sample
the same number of points on each shape and conduct the
statistical shape modeling.
In our work, we use the free-form deformation (FFD) method to
establish the correspondences between the training shapes, which
had been successfully applied in the shape registrations by [8–10].
Among the ns number of training shapes, one shape is chosen
as the template shape, note it as S1 . It is deformed to the other
shapes Sk , k = 2, . . . , ns in the training set respectively and is
then projected onto them to build the correspondences.
The deformation of a shape S ⊂ Rd in the d dimensional
Euclidean space d = 2, 3 is done by the deformation of its
underlying domain Ω ⊂ Rd , here we use the B-spline FFD:
f(u) =



Pi Bi (u),

u ∈ [0, 1]d ,

(1)

i∈I

where {wi } are the shape parameters.
In the step of correspondence identification, the mean shape
is deformed to the subject shape along a path in the shape space
by optimizing the shape parameters {wi } and is then projected
onto the subject shape to establish the boundary correspondence
between the mean shape and the subject shape.
Based on the obtained boundary correspondence, the FE mesh
of the mean shape is then morphed to the subject shape through
free-form deformation.

S1 , S2 ,





{Pi : i ∈ I} is the set of control points, {Bi : i ∈ I} is the set of
B-bases, u is the parameter value.
As shown by Fig. 2, in this paper, the shapes are represented
(k) (k)
(k)
by discrete points: Sk = {v1 , v2 , . . . , vNk }, k = 1, . . . , ns . The
registration of the template shape S1 to a target shape (note it as
S2 for simplicity) is done by minimizing:
min Edeviation + α Esmooth + β Elandmarks .
{Pi }

(2)

X. Wang, X. Qian / Computer-Aided Design 70 (2016) 67–77

(a) Input shapes.

69

¯
(c) Mean shape: S.

(b) Shapes aligned.

Fig. 3. By conducting the generalized Procrustes analysis, we obtain a set of aligned
shapes and the mean shape.

The shapes in S c are represented by the same number of points
that are in correspondences, on which we conduct the generalized
Procrustes analysis [7]and obtain themean shape S¯ and the set of
aligned shapes S a = Sa1 , Sa2 , . . . , Sans that had been projected to

Fig. 2. Shapes in discrete points: the template shape is in red, the target shape is in
blue, we have 56 landmarks on each shape. (For interpretation of the references to
color in this figure legend, the reader is referred to the web version of this article.)

The first term in (2)
Edeviation =

N1


(1)

(2,c ) 2

∥f(vj ) − vj

∥ ,

the tangent space [6] of the mean shape, where S¯ = {p1 , . . . , pN },
(k)
(k)
Sak = {p1 , . . . , pN }, k = 1, . . . , ns , N is the number of sample
points, and
S¯ =

ns
1 

ns k=1

Sak .

(3)

Fig. 3 shows the results of the generalized Procrustes analysis
of 40 hand shapes.

j=1

is the sum of square of deviations between the deformed template
f(S1 ) and the target S2 , f is the deformation field as defined in (1),
(2,c )
(1)
and vj
is the closest point of vj in S2 .
The second term in (2)

Esmooth


2 
2
  
 d ∂


=
f

 dx,
Ω  i=1 ∂ xi


is the smoothing term and penalizes large deformations. The
smoothing coefficient α in (2) is chosen to be large at the initial
deformation steps and reduced gradually.
To guide the deformation, we manually assign a set of landmarks to each shape with presumed correspondences. The third
term in (2)
Elandmarks =

l


∥f(¯v(i 1) ) − v¯ (i 2) ∥2 ,

i =1

captures the mismatch error of the landmarks.
{(¯v(11) , v¯ (12) ), . . . , (¯v(l 1) , v¯ (l 2) )} are the pair of landmarks on S1 and
S2 . The landmark weight β in (2) is decided so that α Edeviation and
β Elandmarks are in the same order of magnitude.
Formula (2) is a formulation that has been widely used in the
pairwise shape registrations [9–14,8,15], to minimize it we adopt
the typical iterative algorithm [9,8,12] in non-rigid shape registration.
After we have found the desired deformation f, we project the
deformed template f(S1 ) onto the target S2 along the vertex normal and establish a point-wise correspondence between S1 and S2 .
The normal on the vertex is calculated by averaging the normals of
its surrounding elements (line segments in 2D and triangle facets
in 3D).
2.2. Generalized Procrustes analysis
Once we have established the point-wise correspondences between the train shapes and the template, we re-sample each shape
with the correspondences and obtain

S c = {Sc1 , Sc2 , . . . , Scns }.

2.3. Principal component analysis
In the generalized Procrustes analysis, we have aligned all the
training shapes to the mean shape and projected them into the
tangent space of the mean shape, by doing these we obtain a linear
space of shapes. Here, we vectorize each shape by rearranging the
coordinates and have: S¯ = [x1,1 , . . . , x1,d , x2,1 , . . . , xN ,d ]T , and
(k)

(k)

(k)

(k)

Sak = [x1,1 , . . . , x1,d , x2,1 , . . . , xN ,d ]T , k = 1, . . . , ns .
g

g

g

We can view those vectorized shapes S1 , S2 , . . . , Sns as points
in the N × d dimensional space, and center them with respect
to themean shape, by that
 we obtain the shape variation matrix
Φ = Φ1 , Φ2 , . . . , Φns , where Φk = Sak − S¯ , k = 1, . . . , ns . The

¯
variations {Φk } together span a linear shape space Θ centered at S.
By calculating the eigen-values λ1 , λ2 , . . . , λns −1 and the
corresponding eigen-modes Ψ1 , Ψ2 , . . . , Ψns −1 of the covariance
matrix Σ = n 1−1 Ψ Ψ T , we obtain a set of orthonormal bases
s
Ψk , k = 1, . . . , ns − 1 for Θ , these bases are the principal directions
that maximize the shape variations, and λk , k = 1, . . . , ns − 1 are
the variances in these directions ordered from large to small.
Usually a good statistical shape model should have the first
several eigen-values to capture a majority of the population
variations and in this case the shape variations can be efficiently
modeled by the first several eigen-modes. We call the space
spanned by the set of eigen-modes Ψk , k = 1, . . . , m, m < ns −
1 the eigen-space Θ of the statistical shape model, which is a
subspace of the whole shape space Θ . We can instantiate new
shape instances in Θ by:

S = S¯ +

m


w k Ψk .

(4)

k=1
s
Usually, we choose m by letting
i=1 λi /
i λi ≥ p, where p is
the percentage of variances we want the first m eigen-modes to
capture. For the 40 hands we choose p = 98.5%, which corresponds
to the first 11 eigen-modes.
In Fig. 4 we show the first three eigen-modes of the hand shapes
obtained by the principal component analysis.
In Fig. 5 we show the cumulative shape variances. In which the
first 8 modes have captured 98.14% of the shape variances and the
first 11 modes have captured 99.01% of the shape variances.

m

n

70

X. Wang, X. Qian / Computer-Aided Design 70 (2016) 67–77
T
by 
S = S¯ +
k=1 wk Ψk , where w = [w1 , w2 , . . . , wm ] are the
shape parameters.
ˆ we search in the eigen-space to find the
Given a new shape S,
optimal shape parameters w that best synthesize it and obtain the
ˆ Then we project 
optimal shape instance 
S in Θ for S.
S onto Sˆ
along the normal so to obtain the finally synthesized shape
SP , from
which the point-wise correspondences between the given shape
and the atlas can be established.
During the eigen-space search, the instantiated shape 
S is in
the reference frame of Θ , while Sˆ locates in the image frame or
physical frame, depends on how it was obtained, and we note the
transformation from the reference frame to the physical frame
as tR,T ,s with parameters R, T , s, where R is the rotation, T is the
translation and s is the scaling. For a point p, tR,T ,s (p) = sRp + T . In
our later expression, we use tR,T ,s ◦ S to denote the transformation
of a shape under tR,T ,s point-wisely.
Similar with the free-form deformation, we search for the optimal shape parameters and transformation by minimizing the distances between the new shape Sˆ and the instantiated shape 
S
follows by a regularization term. We have the total energy function:

m

(a) S¯ ± 2σ1 V1 .

(b) S¯ ± 2σ2 V2 .

(c) S¯ ± 2σ3 V3 .

Fig. 4. The first three eigen-modes of the shapes. Green one is the mean shape,
red is the +2σ deviation and blue is the −2σ deviation. (For interpretation of the
references to color in this figure legend, the reader is referred to the web version of
this article.)

min E = Ed + γ Er ,

R,T ,s,w

Fig. 5. The cumulative shape variances captured by the increasing number of shape
modes.

(5)

where Ed is the distance term and Er is the regularization term just
as Esmooth in the free-form deformation, and large regularization coefficient γ will give strong penalizations to large shape parameters w√when compared with the square roots of the eigen-values
σk = λk , k = 1, . . . , m. We have
Ed = ∥Sˆ c − tR,T ,s ◦ (S¯ + Ψ w)∥2 ,

(6)

captures the discrepancies between given shape Sˆ and the shape
instance 
S = S¯ + Ψ w, where Ψ = [Ψ1 , Ψ2 , . . . , Ψm ], and Sˆ c is the
re-sampling of Sˆ based on the correspondence. We have
Er = wT Λ−1 w,

Fig. 6. The quadrilateral mesh of the mean shape S¯ and the Jacobians.

2.4. Meshing the mean shape
After the statistical shape modeling, we obtain the mean shape
S¯ of the training populations, on which we create a generic FE mesh.
This generic FE mesh will be used as a template to create subjectspecific FE meshes.
Fig. 6 shows the quadrilateral mesh of the mean shape of the 40
hands in Section 2.3, the color shows the value of Jacobians, which
are all positive.
3. Shape instantiation and projection
By the statistical shape modeling, we obtain the mean shape
S¯ and the eigen-modes Ψ1 , Ψ2 , . . . , Ψns −1 of the training populations. The eigen-modes capture the shape variations and together
span a linear shape space. By choosing the first m eigen-modes corresponding to the major shape variations as described in 2.3, we
obtain the eigen-space Θ , and an instance in it can be instantiated

(7)

as the regularization term, where Λ = diag(σ12 , . . . , σm2 ) is the diagonal matrix of the eigen-values.
Similar to the non-rigid registration algorithm in [8,9,12], we
choose large initial regularization coefficient γ and reduce it gradually. So at the beginning, more global transformations are recovered by R, T , s and as γ is reduced, major shape variations are
recovered by the parameters corresponding to larger eigen-values,
and as γ keeps reducing, local fine shape variations are recovered
as the parameters corresponding to smaller eigen-values being effective in (5).
The shape instantiation is done through an iterative process as
shown in Fig. 7, in which the correspondence and the parameters
w, R, T , s are optimized iteratively.
¯ we build the correspondence
Starting from the mean shape S,
between S¯ and the given shape Sˆ by searching the closest point.
Based on the correspondence, we re-sample Sˆ and obtain Sˆ c ,
with which we search for the optimal shape parameters w and
transformation R, T , s by minimize (5). After that we instantiate a
shape instance by 
S = S¯ + Ψ w and transform it to the frame of Sˆ
by tR,T ,s ◦ 
S. Then we update the correspondence with the newly
instantiated shape and iterate until convergence.
With known correspondence and the re-sampled points Sˆ c ,
formula (5) is minimized through iteratively optimizing the shape
parameters w and the transformation R, T , s by applying the
Protocol 1 (Matching model points to target points) of the active
shape algorithm in [16], which was originally used for image
segmentation in [16,17]. The only difference is the way we update

X. Wang, X. Qian / Computer-Aided Design 70 (2016) 67–77

(a) Correspondence.

ˆ
(a) Searching: red 
S, blue S.

(c) Instantiation: 
S.

Then we reduce the regularization coefficient γ , and use the current parameters as the initial input and optimize. If the correspondence does not change any more, we exit the outer loop otherwise
we go to γn .
In the inner loop, we find the optimal parameters for the current
γ by iteratively optimizing the correspondence and the parameters
w, R, T , s. The convergence criteria for the inner loop is that the
change of the shape parameters should be smaller than ε = 10−6 .
Once the correspondence is not changing, we project tR,T ,s ◦ 
S

(d) Searching.

searching the closest point; (b) the re-sampling Sˆ c of Sˆ is obtained with the current
correspondence; (c) a newly instantiated and transformed shape is obtained by
minimizing (5) with the current Sˆ c ; (d) updating the correspondence by the newly
instantiated shape and iterate. (For interpretation of the references to color in this
figure legend, the reader is referred to the web version of this article.)

the shape parameters w. Due to the regularization term added, by
E
= 0, we have
letting ∂∂w



γ
s2

Λ −1

 −1

1
ˆc
Ψ T ( t−
R,T ,s ◦ S − S),

(b) Morphed FE mesh.

Fig. 8. Meshing subject-specific shape by morphing: (a) the correspondence
ˆ (b) results of FE mesh morphing.
between S¯ and S;

(b) Re-sampling: Sˆ c .

Fig. 7. The iterative shape instantiation from a given shape: (a) the correspondence
between the instantiated shape tR,T ,s ◦ 
S and the given shape Sˆ is obtained by

w= I+

71

(8)

1
where t−
R,T ,s is the inverse transformation of tR,T ,s , I is the m × m
1
ˆc ¯
identity matrix. When γ = 0, we have w = Ψ T (t−
R,T ,s ◦ S − S) as
in [16].
The below Algorithm gives a detailed description of our approach:

Algorithm 1 Automatic shape synthesis by SSM

¯ R = I, T = 0, s = 1, I is the m × m identity
– Initialize: 
S = S,
matrix.
– For each regularization coefficient γ ∈ {γ1 , · · · , γn }, γi > γi+1 .
· Until ∥∆w∥ < ε
(i) Find the correspondence by the closest points of tR,T ,s ◦ 
S
ˆ
in S;
(ii) Determine the parameters w, R, T , s by (5) for the current
correspondence and γ ;
(iii) Instantiate the shape by 
S = S¯ + Ψ w and transform it to
the subject frame by tR,T ,s .
· If the correspondence does not change, exit the main loop.
– Project the final instance tR,T ,s ◦ 
S onto Sˆ along the normal and
obtain 
SP , exit.
¯ the eigenThe inputs for Algorithm 1 are the mean shape S,
modes Ψ and the given shape Sˆ for synthesis; the output is the
finally synthesized shape 
SP . With the initialization, we start from
the mean shape and deform it to the given shape through successive shape instantiations.
In the outer loop, under the current regularization coefficient
γ , we found the optimal correspondence, shape parameters w and
transformations R, T , s for the given shape Sˆ which respect to (5).

onto Sˆ along the normal and obtain the optimal shape synthesis

ˆ by which we obtain the one-to-one correspondences
SP for S,
between the mean shape S¯ and the given shape Sˆ as a by-product.
4. Meshing subject-specific shape by morphing
In Section 3 we have shown how to automatically register the
subject shape Sˆ to the mean shape S¯ by the shape instantiation
and projection. As a by-product, we obtain the transformation tR,T ,s
1
ˆ by its inverse t−
from the reference frame to the frame of S,
R ,T ,s
we transform the subject shape Sˆ to the reference frame where
the mean shape locates. Then with the explicit correspondences
¯ we obtain a smooth
between the boundaries of Sˆ and S,
deformation field that morphs the mesh of S¯ to Sˆ by

min
{Pi }

N


∥f(pj ) − pˆ j ∥2 + α Esmooth ,

(9)

j =1

where f is the B-spline field defined in (1), Pi , i ∈ I are its
control points. pj , j ∈ 1, . . . , N is the point on the mean shape

¯ and pˆ j is its corresponding point on Sˆ obtained by the shape
S,
instantiation and projection. The smoothing term Esmooth is the
same as in Section 2.1 and α is the smoothing coefficient. Here since
we know the right correspondences, a small α is enough. e.g., in
the pairwise registration by FFD of the 2D hand, we begin with
α = 30, 000, here α = 50 would be enough.
With the obtained deformation field f, we morph the FE mesh
ˆ
of S¯ to S.
In Fig. 8 we show the correspondence obtained by the method
of Section 3 and the resulting FE mesh from mesh morphing with
the correspondence. The Jacobians in Fig. 8(b) are all positive which
means the mesh is valid.
5. Evaluation
To examine the quality of the proposed approach, we use three
measures: the distance between the instantiated shape and the
given shape, and correlation of normal vectors between the mean
shape and the given shape, and the Jacobians of the subject-specific
mesh obtained.
5.1. Shape deviations
The distance between the instantiated shape and the given
shape is calculated by (6) at the end of the instantiation to eval-

72

X. Wang, X. Qian / Computer-Aided Design 70 (2016) 67–77

uate the quality of the shape instantiation. Small distance means
that we find an instance in the eigen-space that is very close to the
given shape, thus by the projection we can build a reliable correspondence between them. Large distance means either the given
shape is far from the eigen-space or the method has failed to instantiate the correct shape instance.
5.2. Correlation of normal vectors
The correlation of the normal vectors at the corresponding
points between the mean shape and the given shape is calculated
to quantize the quality of the correspondence.
For two random variables x and y, their correlation coefficient

ρ(x, y) =

Cov(x, y)
1

1

Cov(x, x) 2 Cov(y, y) 2

,

(10)

measures the similarity in behavior between x and y, here Cov(x, y)
is the covariance between x and y. The square of the correlation
coefficient ρ 2 (x, y) is the proportion of the total variation in x that
is explained by the variable y in a simple linear regression model
and visa versa [18].
For a random variable x and a d dimension random vector Y,
the multiple correlation coefficient ϱ(x, Y) ∈ [0, 1] between them
is defined as [19]

To check the quality of the morphed mesh for the subjectspecific shape, we calculate the Jacobians at the vertices of each
element. It can be shown that the Jacobians over a linear Bézier
element (which degenerates to a linear Lagrange element) are
bounded by the Jacobians at its corners [20]. So, for the mesh of
bi-linear 2D finite elements and tri-linear 3D finite elements, it is
sufficient to check the Jacobians at the vertices of each element.
For further discussions on the Jacobians of higher order elements,
please refer to [21,22].
6. Numerical results
In the proposed approach in Sections 2, 3, and 4, we build
the statistical atlas from the population of training shapes and
use it to aid the automatic construction of the subject-specific FE
mesh. Then we evaluate the approach by the metrics proposed in
Section 5. Here we show the numerical results of the examples of
the 2D hand shapes, 3D femur proximals and 3D aortas.

(11)

A

−1
where ρ is defined in (10). It turns out that A = Σ12 Σ22
is
the vector of regression coefficients of x on Y, where Σ12 is the
covariance between x and Y whose dimensions are 1 × d, Σ22 is
the covariance of Y itself and is a d × d matrix. So by (10) and (11)
we have [19]


√
−1
Σ12 Σ22
Σ21 / σ11 ,

(12)

where σ11 is the variance of x, Σ21 =
Similarly, ϱ (x, Y)
is the proportion of the variation in x that is explained by the
variables in Y by linear regression with the regression coefficients
−1
A = Σ12 Σ22
.
For two random vectors Xd1 ×1 and Yd2 ×1 , for each individual
component xi , i = 1, . . . , d1 of X, we calculate its multiple
correlation with Y and obtain r = [ϱ1 , . . . , ϱd1 ]T by (12), while
ϱi2 is the proportion of variation in xi that is explained by Y by
linear regression. Thus the total proportion of variation in X that
d
d
is explained by Y can be calculated by i=1 1 ϱi2 σii / i=1 1 σii , where
T
Σ12
.

2

d
σii is the variance of xi , and i=1 1 σii is the total variation in X,
d1 2
and i=1 ϱi σii is the variation of X being explained by Y by linear
regression.
We define


d

d1
1

ϱ(X, Y) = 
ϱi2 σii
σii ,
i =1

5.3. Mesh quality metric

6.1. 2D hand shapes

sup ϱ2 (x, Y) = ρ 2 (x, AY),

ϱ(x, Y) =

is defined in (13). The inequality (14) says that c a is a better
correspondence than c b if it gives larger correlation between the
normal vectors on S1 and S2 .

(13)

i =1

to be the correlation between X and Y and use it to calculate the
correlation of normal vectors of two registered shapes. Note that
ϱ(X, Y) ∈ [0, 1], which achieves 1 if and only if r = [1, 1, . . . , 1]T ,
and achieves 0 if and only if r = [0, 0, . . . , 0]T . Below is the
definition of what is a good correspondence when judged by this
metric:
Definition. We say c a : S1 → S2 is a better correspondence than
c b : S1 → S2 if

ϱ(n1 (x), n2 (c a (x))) > ϱ(n1 (x), n2 (c b (x))),

x ∈ S1 ,

(14)

where n1 (x) is the normal vector at the point x on S1 , n2 (c (x)) the
normal vector at the corresponding point of x on S2 , and ϱ(n1 , n2 )
a

In this section we apply our method on the subject-specific FE
modeling of the 2D hand shapes [6]. We have 40 hand shapes in total and they are scaled and moved into the [0, 1] × [0, 1] bounding
box. Each shape is represented by 2001 uniformly sampled points.
In the FFD registration, the shape S23 is chosen as the template
shape and has been registered to the other training shapes by FFD.
Then we re-sample all the other training shapes by the points on
S23 with the correspondences obtained. The size of the B-spline
control grid in this example is 20 × 20, the smoothing coefficient α
is chosen to be 30 000 at the start of the deformation and is halved
per 8 iterations until α < 10. We choose the weight of landmarks
β = 5.
In Figs. 3 and 4 we show the mean shape and eigen-modes
calculated from the training set of all the 40 re-sampled shapes.
Here we design a leave-one-out experiment. For k = 1, . . . , 40,
each time the kth shape is selected as the subject shape and the
remaining 39 shapes are used as the training shapes. The statistical
shape model is built from the re-samplings of the 39 training
shapes. In this way, the training set will not contain the exact
subject shape.
In the shape instantiation, we use the first 11 eigen-modes
(captures more than 99% of the variation) to instantiate the new
shape. The regularization coefficient γ is chosen to be 0.3 initially
and multiplied by 14 each outer iteration in Algorithm 1 until it is
less than 0.008. In the FE mesh morphing, we choose the smoothing
coefficient α = 50.
The results of shape instantiation and FE mesh construction
of shapes S1 , S26 , S37 are shown in Fig. 9. The left column shows
the results of shape instantiation and the right column shows the
results of FE mesh construction. In the FE mesh construction, the
1
subject shapes were transformed to the reference frame by t−
R ,T ,s .
Among the 40 shapes, only the instantiation of the shape S38
has failed, as shown in Fig. 10(a). As mentioned in [6], S38 belongs
to one of the two outliers (S38 , S40 ) in the training set, which means
it is much farther from the mean shape than other shapes, and is
more likely to be trapped in the local minimum. We say that it is
trapped in the local minimum because there does exist an instance

c
c

S38 in the eigen-space built from S (38) = Sc1 , . . . , Sc37 , S39
, S40
that is closer to S38 than the one we found, as shown in 10(b).
The best match of S38 is obtained by projecting Sc38 into the
eigen-space by


S38 = S¯ + Ψ Ψ T (Sc38 − S¯ ),

X. Wang, X. Qian / Computer-Aided Design 70 (2016) 67–77

(a) Instantiation of S1 .

73

(b) Subject FE mesh of S1 .

Fig. 11. The value of Ed at each iteration. The bold green curve corresponds to
S38 . (For interpretation of the references to color in this figure legend, the reader
is referred to the web version of this article.)

(c) Instantiation of S26 .

(e) Instantiation of S37 .

(d) Subject FE mesh of S26 .

(f) Subject FE mesh of S37 .

Fig. 9. The results of shape instantiation and subject FE mesh construction. In the
left column, the red contour is the mean shape, the blue contour is the subject shape,
the green contours are the locus of shape instantiation. The right column shows the
subject FE mesh and the Jacobians. We could see that all the meshes have positive
Jacobians. (For interpretation of the references to color in this figure legend, the
reader is referred to the web version of this article.)

(a) Instantiation of S38 .

(b) The best match 
S38 .

Fig. 10. The algorithm has failed to correctly instantiate S38 : (a) the locus of the
instantiation, the mean shape is in red, S38 blue; (b) the best match for S38 in the
eigen-space. (For interpretation of the references to color in this figure legend, the
reader is referred to the web version of this article.)

where Sc38 is the re-sampling of S38 with the correspondence
obtained by FFD with 56 landmarks, S¯ is the mean shape of S (38) .
In all other examples of 3D femur and aorta there are no failure
cases because the shapes are similar with each other.
Fig. 11 shows the distance of the instantiated shape (Ed in
Section 3) to the given shape at each iterations. We could see most
of the instantiations succeed in finding an instance close to the
given shape except for S38 , which deviates too much from the mean
shape. The running time is from 1.507530 s (S13 , 168 iteration) to

Fig. 12. The correlation coefficient of normals. Here, we only calculate the
correlation coefficients for the 39 successfully registered shapes.

5.910679 s (S38 , 581 iterations) on Matlab with processor: Intel
Core i7, 3.50 GHz.
In Fig. 12 we plot the correlation coefficients of normals between the template shape and all other registered shapes before
and after the free-form deformation, which are in triangles and
squares, and the correlation coefficients obtained by the shape instantiation, which is in circle. We could see that the proposed correlation metric has nicely distinguished the registered shapes and
unregistered shapes while showing no major differences between
the FFD and the shape instantiation, which indicates that the automatic shape registration by eigen-space search without manual
intervention gives as good correspondence as the free form deformation method with carefully chosen landmarks. Actually, the 56
landmarks we used in the FFD based registration are the same landmarks used by [6].
6.2. 3D femur proximals
Here we apply our method with the femur bones to demonstrate its success in 3D shape synthesis and FE mesh generation.
6.2.1. Constructing statistical atlas
We have a set of 29 femur proximals as shown in Fig. 13. These
femurs are represented by boundary triangulations and are scaled
into the unite bounding box. The number of vertices of each femur
varies from 2912 to 3567. We find the correspondences between
those shapes by FFD with the chosen landmarks in Fig. 13. Then we
re-sample each shape based on the correspondences and conduct
the statistical shape modeling.
Fig. 14 shows the shapes before GPA, after GPA and the mean
shape S¯ of the femurs. Fig. 15 has shown the first three eigen-modes

74

X. Wang, X. Qian / Computer-Aided Design 70 (2016) 67–77

Fig. 17. Hex-mesh of the mean shape and the Jacobians.
Fig. 13. Overlay of 29 femur proximals plotted in different colors. The red, blue and
green points are, respectively, landmarks on the protrude, lower laterals, and femur
heads. (For interpretation of the references to color in this figure legend, the reader
is referred to the web version of this article.)

a

b

c

(a) S¯ red, Sˆ blue.

ˆ
(b) S¯ → S.

¯
Fig. 14. (a) 29 shapes before GPA; (b) 29 shapes after GPA; (c) mean shape S.

(a) S¯ ± 2σ1 Ψ1 .

(b) S¯ ± 2σ2 Ψ2 .

(c) S¯ ± 2σ3 Ψ3 .

Fig. 15. The first three eigen-modes of the femurs: green one is the mean shape,
red is the +2σ deviation and blue is the −2σ deviation. (For interpretation of the
references to color in this figure legend, the reader is referred to the web version of
this article.)

Fig. 16. The cumulative shape variances captured by the increasing number of
shape modes.

out of the 28 and Fig. 16 shows the cumulative shape variances
captured by the increasing number of shape modes from one mode
to the whole 28 modes.
After we obtained the statistical shape model, we create finite
element mesh for the mean shape as shown in Fig. 17.
6.2.2. Shape instantiation and projection
With the obtained statistical shape model, we can conduct
eigen-space search for a given subject-specific shape. Here we did

(c) 
S red, Sˆ blue.

(d) Projected 
SP red and Sˆ blue.

Fig. 18. (a) The mean shape S¯ (the inner red one) and the given shape Sˆ (blue); (b)
the locus of each vertex in the eigen-space search; (c) the result 
S of eigen-space
search; (d) normal projection. (For interpretation of the references to color in this
figure legend, the reader is referred to the web version of this article.)

the same leave-one-out experiment for the femur-proximal as in
the 2D hand example. In the experiment we use 15 eigen-modes
(captures more than 96% of the variation) to instantiate the new
shape.
Fig. 18 shows one example of shape instantiation and projection. Fig. 18(c) shows the instantiated shape 
S and Fig. 18(d) shows
ˆ It is clear that the deviits projection 
SP onto the given shape S.
ation between the synthesized shape 
SP and the given shape Sˆ is
random, indicting a good accuracy of the synthesis process.
Fig. 19 shows the distance of the instantiated shape (Ed in Section 3) to the given shape at each iterations. The average edge
length of each triangle mesh is around 0.02, and all the instantiations have given an average surface deviation just about half of
the average edge length, which shows the success of
√the instantiation. The average surface deviation is calculated by Ed /nv , where
Ed is the square distance defined in (6) and nv is the number of
vertex. The running time is from 0.939999 s (S2 , 65 iteration) to
3.337465 s (S8 , 218 iterations) on Matlab with processor: Intel Core
i7, 3.50 GHz.
In Fig. 20 we compare the correlation coefficients of normals
among the ICP, FFD and SSM based methods. In ICP and FFD, shape
2 is chosen as the template, so the correlation with itself is 1.
For SSM based shape synthesis, we conducted a leave-one-out
test and thus obtained correlation for 29 shapes. The correlations

X. Wang, X. Qian / Computer-Aided Design 70 (2016) 67–77

(a) Sˆ 1 .

75

(b) Sˆ 2 .

(c) Sˆ 3 .

Fig. 19. The value of Ed at each iteration.

(d) S¯ 1 red, Sˆ 1 blue.

(e) S¯ 2 red, Sˆ 2 blue.

(f) S¯ 3 red, Sˆ 3 blue.

(g) 
S1 red, Sˆ 1 blue.

(h) 
S2 red, Sˆ 2 blue.

(i) 
S3 red, Sˆ 3 blue.

Fig. 20. The correlation coefficient of normals.

obtained by SSM synthesized shapes (circle) are slightly better
than the correlations obtained by FFD (square) and show obvious
improvement than the correlations (triangles) obtained by ICP.
This suggests that both FFD and SSM based approaches lead
to comparable shape correspondence. However, FFD requires 3
landmark points for guidance during the deformation process.
In Fig. 21 we have removed the top of the given shapes Sˆ 1 , Sˆ 2 , Sˆ 3
and repeated the same process as we did in Fig. 18. The results
show that our method is very robust even when the shapes are
incomplete. In Fig. 22 we have compared the shape parameters we
obtained from the given complete shapes and the given incomplete
shapes by the shape instantiation, the two sets of parameters only
have minor differences and are in good accordance with each other.
This suggests that the automatic shape instantiation is robust with
incomplete data.

Fig. 21. (a)–(c) are the shapes with missing top; (d)–(f) are the overlappings
of the mean shapes (red) and their respective target shapes (blue); (g)–(i) show
the results 
S1 , 
S2 ,
S3 of eigen-space search (synthesizing). Here we did not do
normal projection because the given shape is incomplete. (For interpretation of the
references to color in this figure legend, the reader is referred to the web version of
this article.)

6.2.3. Automatic FE model generation
As shown in Fig. 23, with the boundary correspondences
obtained in the previous section, we morph the FE mesh of the
mean shape in Fig. 17 to the given shapes Sˆ 1 , Sˆ 2 , Sˆ 3 and obtain the
subject-specific FE meshes, whose Jacobians are non-negative.
6.3. Aorta
Due to the complex structures (two inlets on the main body
and three leaflets inside), the mesh generation of aorta is very
time consuming and the automatic FE mesh generation for aorta
would be very appealing and has important potential practical
applications.
6.3.1. Constructing statistical atlas
We have five aortic models, four of them were used for
constructing statistical atlas and one was used as the given target
shape for shape synthesis.

w

Fig. 22. A comparison of the shape parameters σ i , i = 1, . . . , 15 found for the
i
complete shapes in Fig. 18 and the incomplete shapes in Fig. 21. On the x-axis is the
index of the eigen-modes, on the y-axis is the value of the shape parameter.

As shown in Fig. 24, we have four shapes in the training set.
On each shape we have marked 13 landmarks, based on which
we conducted the FFD based shape registration. Fig. 25 shows the
obtained mean shape model and eigen-modes of the statistical
shape model.

76

X. Wang, X. Qian / Computer-Aided Design 70 (2016) 67–77

(a) FE mesh of Sˆ 1 .

(b) FE mesh of Sˆ 2 .

(c) FE mesh of Sˆ 3 .

Fig. 23. The automatic generated FE mesh for the three given shapes in Fig. 21.

(a) T.
(a) S1 .

(b) S2 .

(c) S3 .

(d) S5 .

Fig. 24. Four aortas in the training set to build the statistical atlas.

¯
(a) S.

(b) S¯ ± 2σ1 Ψ1 .

(c) S¯ ± 2σ2 Ψ2 .

(d) S¯ ± 2σ3 Psi3 .

Fig. 25. Mean shape and the eigen-shapes.

ˆ
(a) S.

ˆ
(b) S¯ → S.

ˆ
(c) 
S and S.

(d) 
SP .

ˆ (b) the overlay of the mean shape S¯ (red) and Sˆ
Fig. 26. (a) The given shape S;
(blue); (c); shape instance 
S optimized in the eigen-space; (d) projection to obtain
the synthesized shape 
SP . (For interpretation of the references to color in this figure
legend, the reader is referred to the web version of this article.)

6.3.2. Shape instantiation and projection
With the obtained mean shape S¯ and three eigen-modes
ˆ we automatically instantiate it
Ψ1 , Ψ2 , Ψ3 , given a new shape S,
with the shape instances in the eigen-space and find the correspon¯ In Fig. 26
dences between the given shape Sˆ and the mean shape S.
we show the process of shape instantiation and projection.
6.3.3. Automatic FE mesh generation
With the correspondences obtained in the projection step, we
automatically morph the hexahedral mesh of the mean shape to
the given shape Sˆ (Fig. 26(a)) by the free-form deformation in
Section 4. The resulting hexahedral mesh is shown in Fig. 27.
7. Conclusion
This paper presents a statistical atlas based approach for
subject-specific FE modeling and involves three parts: (1) constructing a statistical atlas, including the mean shape and eigenmodes of a shape population which span a linear shape space, and
the generic FE mesh built on the mean shape; (2) establishing the
correspondence between a given subject shape and the atlas by
shape instantiation and projection; and (3) deforming the atlas

ˆ
(b) T.

Fig. 27. (a) Hexahedral mesh of the mean shape, (b) generated Hexahedral mesh
(green) of the given shape Sˆ (red). (For interpretation of the references to color in
this figure legend, the reader is referred to the web version of this article.)

to the subject shape based on the shape correspondence. The approach has been successfully applied in automatic FE modeling of
2D hands, 3D femur bones and 3D aorta.
Numerical examples demonstrate that the statistical atlas based
approach allows automatic FE modeling of subject-specific shapes,
even when a given subject-specific shape deviates significantly
from the mean shape. This is advantageous over the template
deformation based approach in that large deviations between the
template and the given shape usually require manual specification
of shape correspondence for it to work.
One potential limitation of our approach is that the instantiated
shape is only a local optimal solution to the optimization formula
(5). However, the examples show that in most cases we can find
the correct shape instance even when the subject shape deviates
significantly from the mean shape.
Our current approach to statistical shape modeling relies on
manual specification of landmarks to establish correspondence
among the shape population. For automatic correspondence,
approaches such as [23,24] can be used.
Future work would extend this approach to FE modeling from
subject-specific medical images such as computed tomography
or magnetic resonance images. This would bypass the need for
segmentation of these images.
Acknowledgments
We would like to acknowledge our data sources: (1) Mikkel B.
Stegmann at Technical University of Denmark for the hand data;
(2) Dr. Alejandro A. Espinoza Oras at Rush University Medical
Center for the femoral bone data; (3) Dr. Sun Wei at the Georgia
Institute of Technology for the aorta data.
References
[1] Baldwin MarkA, Langenderfer JosephE, Rullkoetter PaulJ, Laz PeterJ. Development of subject-specific and statistical shape models of the knee using an
efficient segmentation and mesh-morphing approach. Comput Methods Programs Biomed 2010;97(3):232–40.
[2] Grassi Lorenzo, Hraiech Najah, Schileo Enrico, Ansaloni Mauro, Rochette Michel, Viceconti Marco. Evaluation of the generality and accuracy of
a new mesh morphing procedure for the human femur. Med Eng Phys 2011;
33(1):112–20.
[3] Bucki Marek, Lobos Claudio, Payan Yohan. A fast and robust patient specific
finite element mesh registration technique: application to 60 clinical cases.
Med Image Anal 2010;14(3):303–17.
[4] Bryan Rebecca, Mohan PSurya, Hopkins Andrew, Galloway Francis, Taylor Mark, Nair PrasanthB. Statistical modelling of the whole human femur
incorporating geometric and material properties. Med Eng Phys 2010;32(1):
57–65.

X. Wang, X. Qian / Computer-Aided Design 70 (2016) 67–77
[5] Zhang Yongjie, Liang Xinghua, et al. An atlas-based geometry pipeline for
cardiac hermite model construction and diffusion tensor reorientation. Med
Image Anal 2012;16(6):1130–41.
[6] Stegmann MikkelB, Gomez DavidDelgado. A brief introduction to statistical
shape analysis, Informatics and Mathematical Modelling, Technical University
of Denmark, DTU, 15:11, 2002.
[7] Gower JohnC. Generalized procrustes analysis. Psychometrika 1975;40(1):
33–51.
[8] Chui Haili, Rangarajan Anand. A new point matching algorithm for Non-rigid
registration. Comput Vis Image Underst 2003;89(2):114–41.
[9] Wang Hesheng, Fei Baowei. Non-rigid point registration for 2D curves and 3D
surfaces and its various applications. Phys Med Biol 2013;58(12):4315.
[10] Huang Xiaolei, Paragios Nikos, Metaxas DimitrisN. Shape registration in
implicit spaces using information theory and free form deformations. IEEE
Trans Pattern Anal Mach Intell 2006;28(8):1303–18.
[11] Belongie Serge, Malik Jitendra, Puzicha Jan. Shape matching and object
recognition using shape contexts. IEEE Trans Pattern Anal Mach Intell 2002;
24(4):509–22.
[12] Amberg Brian, Romdhani Sami, Vetter Thomas. Optimal step non-rigid ICP
algorithms for surface registration. In: IEEE conference on computer vision and
pattern recognition, 2007. CVPR’07. IEEE; 2007. p. 1–8.
[13] Li Hao, Sumner RobertW, Pauly Mark. Global correspondence optimization for
non-rigid registration of depth scans. In: Computer graphics forum. Vol. 27.
Wiley Online Library; 2008. p. 1421–30.
[14] Baek Seung-Yeob, Lee Kunwoo. Parametric human body shape modeling
framework for human-centered product design. Comput-Aided Des 2012;
44(1):56–67.

77

[15] Belongie Serge, Malik Jitendra, Puzicha Jan. Matching shapes. In: Eighth IEEE
International conference on computer vision, 2001. ICCV 2001. Proceedings.
Vol. 1. IEEE; 2001. p. 454–61.
[16] Cootes Tim, Baldock ER, Graham J. An introduction to active shape models.
In: Image processing and analysis. 2000. p. 223–48.
[17] Cootes TimothyF, Taylor ChristopherJ, Cooper DavidH, Graham Jim. Active
shape models-their training and application. Comput Vis Image Underst 1995;
61(1):38–59.
[18] Wackerly Dennis, Mendenhall William, Scheaffer Richard. Mathematical
statistics with applications. Cengage Learning; 2007.
[19] Anderson TheodoreWilbur. An introduction to multivariate statistical analysis.
Vol. 2. New York: Wiley; 1958.
[20] Lin Hongwei, Tang Kai, Joneja Ajay, Bao Hujun. Generating strictly non-selfoverlapping structured quadrilateral grids. Comput Aided Des 2007;39(9):
709–18.
[21] Wang Xilu, Qian Xiaoping. An optimization approach for constructing
trivariate B-spline solids. Comput-Aided Des 2014;46:179–91.
[22] Qian Xiaoping, Sigmund Ole. Isogeometric shape optimization of photonic
crystals via Coons patches. Comput Methods Appl Mech Engrg 2011;200(25):
2237–55.
[23] Davies RhodriH, Twining CaroleJ, Cootes TimothyF, Taylor ChrisJ. Building 3D
statistical shape models by direct optimization. IEEE Trans Med Imaging 2010;
29(4):961–81.
[24] Li Kang, Qian Xiaoping. Direct diffeomorphic reparameterization for correspondence optimization in statistical shape modeling. Comput-Aided Des
2015;64:33–54.

