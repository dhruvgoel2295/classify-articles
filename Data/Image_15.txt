IEEE TRANSACTIONS ON IMAGE PROCESSING, VOL. 5, NO. 11, NOVEMBER 1996 1539
Behavioral Analvsis of AnisotroDic
Diffusion in Image Processing
Yu-Li You, Wenyuan Xu, Allen Tannenbaum, and Mostafa Kaveh, Fellow, IEEE
Abstruct- In this paper, we analyze the behavior of the
anisotropic diffusion model of Perona and Malik. The main idea
is to express the anisotropic diffusion equation as coming from
a certain optimization problem, so its behavior can be analyzed
based on the shape of the corresponding energy surface. We
show that anisotropic diffusion is the steepest descent method
for solving an energy minimization problem. It is demonstrated
that an anisotropic diffusion is well posed when there exists
a unique global minimum for the energy functional and that
the ill posedness of a certain anisotropic diffusion is caused by
the fact that its energy functional has an infinite number of
global minima that are dense in the image space. We give a
sufficient condition for an anisotropic diffusion to be well posed
and a sufficient and necessary condition for it to be ill posed
due to the dense global minima. The mechanism of smoothing
and edge enhancement of anisotropic diffusion is illustrated
through a particular orthogonal decomposition of the diffusion
operator into two parts: one that diffuses tangentially to the
edges and therefore acts as an anisotropic smoothing operator,
and the other that flows normally to the edges and thus acts
as an enhancement operator.
I. INTRODUCTION
HERE has been a great deal of interest in anisotropic T diffusion since it was first proposed by Perona and Malik
[27] as a useful tool for multiscale description of images,
image segmentation, edge detection, and image enhancement.
The basic idea behind anisotropic diffusion is to evolve from
an original image uo(x, y), defined in a convex domain
R c Rx R, a family of increasingly smooth images U(Z, y, t)
derived from the solution of the following partial differential
equation [27]:
dU
- = div [c( IVul)Vu] at
with initial condition u(x, y, 0) = uo(z, y). The diffusion
coefficient c(.) is a nonnegative function of the magnitude
of local image gradient lVul = Jy. U; + u2 The desirable
diffusion coefficient should be such that (1) diffuses more
in smooth areas and less around large intensity transitions,
so that small variations in image intensity such as noise
Manuscript received February 6, 1995; revised March 8, 1996. This
work was supported by the BMDOAST program managed by the Office of
Naval Research under Contract N00014-92-J-1911, by the National Science
Foundation under Contract ECS-9122106, by the Air Force Office of Scientific
Research under Contract F49620-94-1-0058DEF, and by the Army Research
Office under Contracts DAAH04-94-G-0054 and DAAH04-93-C-0332. The
associate editor coordinating the review of this manuscript and approving it
for publication was Prof. Dan Schonfeld.
The authors are with the Department of Electrical Engineering, University
of Minnesota, Minneapolis, MN 55455 USA (e-mail: kaveh@ee.umn.edu).
Publisher Item Identifier S 10.57-7149(96)07893-I.
and unwanted texture are smoothed and edges are preserved.
Another objective for the selection of c(.) is to incur backward
diffusion around large intensity transitions so that edges are
sharpened, and to assure forward diffusion in smooth areas
for noise removal. Two such diffusion coefficients suggested
by Perona and Malik [28] are
and
1
C(.) =
1 + (g (3)
where IC is a constant to be tuned for a particular application.
Unfortunately, it has been widely noted that anisotropic diffusions
with diffusion coefficients given by (2) and (3) are ill
posed in the sense that images close to each other are likely to
diverge during the diffusion process. For example, the presence
of noise, especially when the gradient generated by noise is
comparable to that by image features, can drive the diffusion
process to undesirable results [27], [36]. Even without noise,
“staircasing” effects can arise around smooth edges [36]. In
practical implementation on computer, the diffusion process
may diverge depending on difference schemes and grid sizes
Several arguments about the ill posedness of the anisotropic
diffusion are based on the work by Hollig et al. [18], which
states that one-dimensional (1-D) anisotropic diffusion is well
posed if and only if
1251.
d’(4 2 0 (4)
d(S) = sc(s). (5)
where the 4(s) is a flux function defined as
Since the behavior of two-dimensional (2-D) diffusion is
obviously more complex than its 1-D counterpart, a thorough
behavioral analysis of 2-D anisotropic diffusion would
benefit further development of powerful anisotropic diffusion
schemes.
The ill-posedness of anisotropic diffusion may be alleviated
through the introduction of a smoothing operation to the
variable of diffusion coefficient c(s). One such example [XI is
dU
- = div {c[lVG(s) * ul]Vu} dt
where G(s) * 71, denotes a convolution of the image at time t
with a Gaussian kernel of scale s, which is to be given a priori.
1057-7149/96$05.00 0 1996 IEEE 
1540 IEEE TRANSACTIONS ON IMAGE PROCESSING, VOL. 5, NO. 11, NOVEMBER 1996
A properly selected s is critical to the success of the proposed
anisotropic diffusion in the sense that the diffusion process
would be ill posed for too small an s, while image features
would be smeared for too large an s. One possible solution is
to use a large s initially to suppress noise and then to reduce
the s so that image features are not further smeared [36].
Nevertheless, optimum selection of such an s is still an open
problem. The computational load involved in the convolution
G(s)*u is a serious problem because it is required at each time
instant, whether it is implemented directly or by a separate
isotropic diffusion. We also note that this peculiar scheme
of linear isotropic diffusion within anisotropic diffusion is
obviously against the spirit of anisotropic diffusion. Timedelay
regularizations have also been proposed; see [19].
An alternative is to use curve evolution, which is based on
geometric heat flow of the level sets of the image. Diffusion
schemes proposed include curvature motion [ 11-[3], [211, [26],
[32], reaction-diffusion [20], and affine invariant scale-space
This paper will express anisotropic diffusion as resulting
from an optimization problem. This is in the spirit of the
total variational methods of [29]. We show that anisotropic
diffusion is an energy-dissipating process, so its behavior can
be analyzed by the shape of the energy surface. Specifically,
we show in Section I1 that anisotropic diffusion is a process
that dissipates energy with time, and its behavior depends on
the shape of the energy surface. Section I11 gives conditions for
the well-posedness and ill-posedness of anisotropic diffusions.
Section IV proposes an orthogonal decomposition of the
anisotropic diffusion operation and its geometric interpretation,
which gives some insights into how anisotropic diffusion
smooths small variations in image intensity and sharpens
edges. Section V analyzes some known anisotropic diffusion
schemes as well as proposes new ones. Section VI outlines
our plans of extending to vector case (in particular, the color
space). Numerical simulations are shown in Section VII. We
conclude this paper in Section VIII.
121, ~301.
11. DIFFUSION AS AN ENERGY-DISSIPATING PROCESS
In this section, we demonstrate that anisotropic diffusion
results from an optimization problem and relate its behavior
to the shape of the corresponding cost (or energy) functional.
A., Smooth Images
Let us first consider the following energy functional defined
on the space of smooth images, that is, images for which Vu
is finite in 0, as in the following:
E(u) = f(lV4)dn (7)
where f(lVu1) 2 0 is an increasing function of /Vul, as
follows:
f’(P4) > 0. (8)
We also require that f’(lVu1) = 0 when lVul = 0. Due to the
nonnegativity of f( IVul), the energy functional is bounded
below:
E(u) 2 0. (9)
Since lVul 2 0 and f( IVul) is an increasing function of IVul,
the global minimum of E(u) occurs when
u(z, y) z constant, for all (x, y) E R. (10)
This global minimum includes an infinite number of constant
images, all of which have the same value of E(u). This
energy functional is a measure of image smoothness and its
minimization is equivalent to smoothing. Note that if f(2) =
2, (7) is the seminorm of the space of functions of bounded
variation and is used as the basis for the total variation-based
noise removal algorithm in [29].
We now seek to minimize E(u) by considering the first
G2teaux variation of E(u) at U in the direction h 1341, as
follows:
We need to identify conditions under which
dE(u; k) = 0 for small k. (12)
Let Ro = {(z, y): IVu(z, y)I = 0, (2, y) E Q}, the G2teaux
variation can be obtained through some elementary calculus as
dE(u; h) = f’(0) lVhl dR 6,
Let us choose an h such that
IVhl f0, (2, Y) E Qo; (14)
(Vh =0, otherwise. (15)
Then the second term of (13) is zero, but the first term is not.
In order for dE(u; h) = 0, we must have
f’(0) = 0. (16)
We can write the first term of (13) as
if we denote 6 = [0, 0IT and define
Then the two terms in (1 3) can be packed together to give
By Green’s theorem, we have 
YOU et al.: ANISOTROPIC DIFFUSION 1541
where i3R is the boundary of image domain R and 6 is the
outward normal to do. If we assume symmetric boundary
condition for the image
Vu(x, y) .6 = 0 for (z, y) E i3R (21)
the second term of (20) vanishes and the G2teaux variation
can then be expressed as
dE(u; h) = (VE(u), h,) (22)
where (., .) is the inner product defined by
(23)
and
is the gradient of E(u) at U.
Similar to steepest descent, we may minimize the functional
E(u) by moving in the negative direction of the gradient
through the following parabolic partial differential equation:
Obviously, (25) is the same as the anisotropic diffusion (1) if
the diffusion coefficient is set to
As required of a diffusion coefficient, it is nonnegative due
to (8). It is also obvious that the flux function used for 1-D
diffusion [see (5)] is
(27)
Since the energy functional is bounded below [see (9)],
the stability of the system given by (25) can be proved by
showing that the system dissipates energy with time. The time
derivalive of the energy functional E[u(t)] of the system is
$qS) = SC(9) = .f’(s).
which is the Ggteaux variation (11) of E(u) at u(t) in the
direction of h = -VE(u). Consequently, we have by (22)
dE[u(t)l = (VE(u), -VE(u)) dt
= - (VE(u), VE(u))
50 (29)
which indicates that the anisotropic diffusion is indeed
an energy-dissipating process with time. Therefore, the
anisotropic diffusion is a motion that seeks out minima of
E(u) and comes to a stop at stationary points where
VE(u) = 0. (30)
Since the energy functional is a measure of image smoothness,
the energy-dissipating process of anisotropic diffusion
Fig. 1.
edges in the image.
Interpretation of integral by impulse function when there are step
There is a step image (global minimum)
between any two continuous images
\ Continuous I
I
Image Space
Fig. 2.
ill posed.
Illustration of the reason that some anisotropic diffusion models are
(25) gives a continuum of images with increasing degrees of
smoothness. The behavior of anisotropic diffusion is obviously
dependent on the shape of the energy surface. If the global
minimum given by (10) is the unique minimum of the energy
surface, the diffusion process will converge to it starting
from any initial image. The anisotropic diffusion may then be
interpreted as “well posed.” On the other hand, we will show
that, under a certain condition, the energy functional will have
an infinite number of global minima, which are dense in the
image space, so the anisotropic diffusion is ill posed because
the diffusion process, starting from images close to each other,
will be caught in different local minima, and we will observe
that images close to each other diverge during the diffusion
process.
The well posedness, or the argument that the global minimum
given by (10) is the unique minimum of the energy
surface, is critical to the use of anisotropic diffusion as a tool
for scale space filtering. If there exist local minima on the
energy surface, the diffusion process may be trapped in one
of them and the smoothness of the image will stay at a level 
1542 IEEE TRANSACTIONS ON IMAGE PROCESSING, VOL. 5, NO. 11, NOVEMBER 1996
where the sz, i = I, 2, . . . , n are constants and are required
in this paper not to be equal for adjacent Ri’s. As an example,
we give the following step image:
s1, 20 L 2 <21
s(z, y) = 52, 21 L 2 < 52 (34) i s3, 52 I 5 5x3 Diffusion orthogonal
to@adientdirection where SI # s2 and s2 # sg.
following two integrals:
The integral in (7) can then be written as the sum of the
E(u) = E(w) + E(s) (35)
Fig. 3. Orthogonal decomposition of anisotropic diffusion
higher than that of the global minima. Correspondingly, the
resolution of the image will stay at a level higher than that of
the global minimum and the integration time t is no longer a
valid scale-space parameter.
B. Piecewise Smooth Images
The above derivation has been based on an energy functional
E(u) defined on the space of smooth images. Since
an interesting image containing edges is better modeled by
piecewise smoothness, it is the task of this section to extend
the definition of the energy functional E(u) and the general
results of last subsection to piecewise smooth images. Let
I(R) denote the image space that is defined to be the set of
piecewise smooth functions on R with discontinuities being
only step edges. The primary difficulty in extending the
definition of E(u) to this image space is that the magnitude
of gradient (Vu1 is infinite at step edges. If the integral in
(7) is understood in the usual sense, the step edges will
not contribute to the value of the energy functional. This is
obviously not reasonable in the present context because step
edges are rough images in our image space. A strict treatment
would involve Lebesgue-Stieltjes integral. But here we forego
strict mathematical rigor and resort to the use of the Dirac
delta function.
An image u(x, y) E I(0) may be written as
45, Y) = 745, Y) + 45, Y) (31)
where the w(z, y) is the smooth part of u(z, y) and s(5, y)
represents its step edges, which we call a “step image” and
define as follows.
Dejinition I-Step Image: Let S be a subset of R. The
function defined by
is known as the characteristic function of S. A step image
is a linear combination of a finite number of characteristic
functions. Specifically, let O,, i = 1, 2, . . . , TL be a partition
of R; then the step image is
n
i=l
(33)
where the E(w) involves the usual integral with a smooth
integrand and the E(s) is the integral with a step image as
its integrand. We discuss the latter integral using impulse
functions as follows. Let us suppose that s(x, y) consists
of a step edge along a curve 1 (not necessarily connected
nor closed) with a jump of J(x, y) (shown in Fig. 1). We
approximate this step edge by a slope edge ~(x, y; a) (Fig. 1)
with a width of A, so the magnitude of the gradient at the
slope is
This is an impulse function as A + 0, because it tends to cc
and its area tends to A [IJ(z, y)l]/A = lJ(x, y)l. We now
integrate E(v) in the direction orthogonal to that of 1 and then
integrate along 1. This gives us
Since 7J(2, y; A) 4 s(5, y) as A + 0, we have
a
(37)
Since it is obvious that f’(oc) = 0 whenever f (m) < CO, the
above equation can be simplified to give
E(s) = S’(m) 1 IJ(-? !/)I d1 (39)
which is actually a line integral of the jump of the step edge.
This is a generalization of the results in [l].
With the previous extended definition of the energy functional
E(u), we can show that the expressions of &(U,; h)
(19) and VE(u) (24) are still valid, except that all the
derivatives involved are generalized derivatives. Therefore,
the relation between anisotropic diffusion and the energy
functional discussed in last section can be used to give an
analysis about the behavior of anisotropic diffusion. 
YOU et al.: ANISOTROPIC DIFFUSION 1543
111. SHAPE OF THE ENERGY SURFACE AND we have
BEHAVIOR OF ANISOTROPIC DIFFUSION
Having the relation between anisotropic diffusion and the
energy functional E(u), we can now proceed to analyze the
behavior of anisotropic diffusion based on an analysis of the
shape of the energy functional. We do this by identifying
conditions for the existence of stationary points of E(u) and
analyzing the nature of the stationary points.
Dejinition 2: An image U E I(R) is a stationary point of
E(u) if
dE(u; h) = 0, for all small h E I(n) (40)
or equivalently, if
VE(u) = 0. (41)
Due to (16) and (18), we have
VU f’(lVu1) - = 0, for (2, y) E R - fi. (48) I V’ZLI
Combining (47) and (48) we have
(49)
VU f’(lVu1) __ = 0, for (2, y) E R
lVUl
which indicates VE(u) z 0 by (24).
Let us now prove the “only if’ part. Consider the Ggteaux
variation (19) of E(u) at the step image s in the direction
h = s, as follows:
A. Ill-Posed Anisotropic Diffusion dE(s; s) = f’(lVs()lVsl dR. (50)
We will show in this subsection that, under a certain
condition, the energy functional E(u) has an infinite number of
global minima (step images) that are dense in the image space.
So the diffusion process, starting from images no matter how
close to each other, will be caught in different local minima.
Consequently, we observe that images close to each other
diverge as the diffusion process evolves, so the anisotropic
diffusion is ill posed.
Let us consider the step image (33) and denote fl =
U,=l, 2, , 11 80, where dR, is the boundary of R,, respectively.
Then the gradient of the image (33) can easily be
obtained as
. ..
Since f’(lVsl)lVsl = 0 = f/(co)IVsl when lVsl = 0, the
last equation can be written as
dE(s; s) = f’(00)lVsl dR (51)
which, when interpreted by (39), is
dE(s; s) = f’(C0) IJ(., y)I dl. (52) 1
For the step image (33), the integral in the last equation is not
zero, so dE(s; s) = 0 only if f’(oo) # 0. This completes the
proof.
00, (2, y) E fl The following theorem illustrates the nature of the stationary
Theorem 2: If the f(.) of an anisotropic diffusion satisfies
(44), then each of the dense step images (33) is a global
(42) points.
For the example image (34), this is
minimum of E(u) and the E(u) is discontinuous for all
smooth images except for the constant image (10). JVu(z, y)I = (sa - Sl)S(Z - XI) + (Sj - s2)6(5 - 22) (43)
where 6(z) is the Dirac impulse function.
Theorem 1: Each of the step images (33), which are dense
in the image space I(R), is a stationary point of E(u) if and
Proof: For a step image s, the w in (31) is a constant
image, and we find from (39) that E(s) = (I due to (33), so
(35) gives
only if E(s) = E(constant image) (53)
f’(w) = 0. (44)
Proof Let us first note that step images are dense in
the image space I(0) because each continuous signal can be
infinitely approximated by a sequence of step signals; that is,
for each continuous signal U there exists a sequence of step
signals {sn}, n = 1, 2, ... such that
lim s, = U. n-oo
Let us now prove the “if’ part. Since
(45)
which is the same value as that of the global minimum (10)
of E(u). So each of the step images (33) is a global minimum
of E(IL).
Let us consider (45), which states that a continuous signal
IL can always be infinitely approximated by a sequence of
step signals s,, n, = 1, 2, .... For a continuous image U, it
is obvious that E(u) # 0 except that U is the constant image
(10). On the other hand, the conditions (39) and (44) give
E(s,) = 0, n = 1, 2, ..., so that
lim E(s,) =O # E(u). (54) n-cx
VU
VU
0 L lim IS” Therefore, E(u) is not continuous at U except for the constant
We now give a simplified illustration of how anisotropic
diffusion is ill posed (see Fig. 2). We compare our image
space to the real line, continuous images to rational numbers,
image (10). IVul-00
= IVul-00 lim f’(lVul) lml
=f’(00) = 0 (46) 
1544
’-1
IEEE TRANSACTIONS ON IMAGE PROCESSING, VOL. 5, NO. 11, NOVEMBER 1996
a=5, b=0.01
6 8 10 .I
n
a=5, b=0.01
0.2
X
.I
A
Fig. 4. Example of modified f’(.)
Then the integrand is positive in this area due to (8); hence,
it is not possible that the integral is zero for a smooth image,
except for the constant image (10). Therefore, all images in
I(n), except for the constant image (lo), are not the stationary
This theorem basically establishes that, if (55) holds, the
constant image (IO) is the unique global minimum of E(u).
But this does not exclude the possibility that the surface of
E(u) is still irregular in the sense that the diffusion process
may still exhibit some strange behavior even though it will
finally converge to the constant image (10). For example, the
diffusion given by (92) has f’(m) = 1 # 0, so the constant
image is the unique global minimum by the last theorem. But a
step-image-like effect still appears during the diffusion process
(see the right of Fig. 5 and the bottom of Fig. 6) though it
finally disappears, as required by the last theorem. Therefore,
we need conditions stronger than (55) to make the surface of
E(u) regular enough to prevent the step-image-like effect to
appear during the diffusion process. One way to achieve this
is to require that E(u) be convex.
Theorem 4: If the f(.) of an anisotropic diffusion is convex,
then its energy functional E(u) is convex and the constant
image (IO) is its unique global minimum.
point of E(u).
Prooj? Let 7L1, u2 E I(n) with 2~1 # u2; then, for each
X E (0, 1), we have the following by the Minkowski inequality
[241:
(57)
and step images to irrational numbers. Then, according to
Theorems 1 and 2, the energy functional has nonzero values
for all “rational numbers” and zero values for all “irrational
numbers.” Since irrational numbers are dense on the real
line (there is an irrational number between any two rational
numbers), the energy functional is very “rough” and it is not
possible to know which one of the dense “irrational numbers”
the anisotropic diffusion will settle down to.
IV[XUl + (1 - X)?LZ]I I XIVUll + (1 - X)/VuzI.
Since f(.) is strictly increasing (refer to (8)), (57) gives
f{lv[xu, + (1 - ~)?~~]l} 5 f[X/vulI + (1 - X)1Vu21]. (58)
The convexity of f(.) gives
B. Well-Posed Anisotropic Diffusion
It is obvious that an anisotropic diffusion is well posed if the
constant image given by (10) is the unique global minimum
of the energy functional E(u), because the diffusion process,
starting from different images, will get closer and closer as
the diffusion descends toward the global minimum. It is the
task of this section to identify conditions for the existence of
a unique global minimum.
By Theorem 1 we know that the step image (33) are not
a stationary point of E(u) if f’(00) # 0. This result is now
extended to give the following theorem.
Theorem 3: Only the constant image (10) is the stationary
point of E(u) if
which is
E[XU~ + (1 - X)U~] 5 XE(u1) + (1 - X)E(U~). (62)
as follows:
f(x) 2 f(m) + f’(xo)(z - 50) for all ZO,~ 2 0. (63)
(56)
Let us assume that the smooth image U is not a constant image,
If we let xo = 00 and assume that f’(z0) = ~’(co) = 0, the
above inequality gives
dE(u; U) = .I, f’(lVul)lVul do.
then there exists at least some area 0‘ c S2 in which /Vu\ # 0. f(z) 2 f(w) for all z 2 0 (64) 
YOU et al ANISOTROPIC DIFFUSION 1545
Fig. 5. 18.
Left column: Perona and Malik’s diffusion. Middle column: extended version of the diffusion scheme previously developed by the authors. Right column:
diffusion scheme that does not have step images as its stationary points, though step images appeared anyway.
Smooth sigmoid image is changed into step images by anisotropic diffusion. From top to bottom, the diffusion time t = 2”, n = 0, 1, .. .
which contradicts with the fact that f(.) is increasing. Therefore,
we must have ~’(co) # 0, and by Theorem 3 we
and Jz be the jumps of s1 and sa, respectively. Then by (39)
and the Minkowski inequality [24], we have
complete the proof.
Step edges are accounted for in the above proof because the
problem of the integral. Actually, we can verify in the followE[XSl+
(1 - X)sz]
= f’(cm) J’ IXJl + (1 - X)Jzl dl
5 Xf’(00) 1 Ib711 dl + (1 - X)f’(m) / IJzl dl
= XE(s,) + (1 - X)E(sz)
proof does not use any properties related to the interpretation
ing that the above theorem does hold for step images. Suppose
$1, s2 E I(n) with s1 # s2 are two step images with their
step edges along the curves I1 and 12. Let 1 = 11 U Z2 and J,
1
(65) 
1546 IEEE TRANSACTIONS ON IMAGE PROCESSING, VOL. 5, NO. 11, NOVEMBER 1996
which is the same as what (62) would give for step edges
when its integral is interpreted by (39).
Corollary I: If f”(z) 2 0 for all x 2 0, then the constant
image (10) is the unique global minimum of E(u) and the
anisotropic diffusion is well posed.
Proof This is obvious by a theorem in [6], which states
that f(.) is convex if and only if f”(x) 2 0 for all z 2 0. B
Remark I: Another proof is given in [37].
IV. AN ORTHOGONAL DECOMPOSITION
AND ITS GEOMETRIC INTERPRETATION
After having discussed the global behavior of anisotropic
diffusion, we would like to give some insights into how
anisotropic diffusion works locally to enhance or smear edges,
or t~ smooth or magnify noise.
A. An Orthogonal Decomposition
At a specific location (2, y) E R, the behavior of anisotropic
diffusion (25) is obviously dependent on f’[lVu(x, y)l] which,
in turn, depends on the characteristics of f[lVu(x, y)j].
For optimization purposes, which is the case at hand,
f[/Vu(z, y)l] is best characterized by the eigenstructure of
its Hessian matrix
a2f(lw a”(lVul)
ax2 all: ay
dydx dy2
N(Z, y) = a2f(iVui) a2f(iVul)
The eigenvalues of the H(z, y) can be shown to be
and
X2(/V4) = f”(IVul). (67)
By (26), it is obvious that A1(IVul) = c(/Vu/). The
anisotropic diffusion (25) can then be expanded into
dU
at - AID, + AsD, --
where
and
u;u,, + 2u,uyuzy + u;uyv
U; +U;
D, = (70)
are the second-order directional derivatives of u in directions
orthogonal and parallel to the local gradient, respectively.
Since the two second-order directional derivatives are in
orthogonal directions, (68) represents an orthogonal decomposition
of anisotropic diffusion (see Fig. 3). We note here that
the idea of degenerate diffusion was previously mentioned in
[11.
Since the diffusion coefficient is nonnegative due to (8), the
first term of (68) represents a degenerate forward diffusion in
the direction orthogonal to the gradient. Thus, this directional
smoothing should be encouraged since it represents a well
E 2 200
3100
W
0)
c
c
- E
0
20
300
Diffusion time 00 X
300
C
d G 100 m
-100
20
Diffusion time 00 X
300
p 200
C
._ E 100
P
- EO
0
-100
20
300
300
Diffuison time 00 X
Fig. 6. Evolution with time of a slice along the z axis of the smooth
sigmoid image when it is processed by anisotropic diffusion. Note that
the indexes in the “Diffusion time” axis are the powers of 2. Top: Perona
and Malik‘s diffusion. Middle: extended version of the diffusion scheme
previously developed by the authors. Bottom: diffusion scheme that does not
have step images as its stationary points, though step images appeared anyway.
posed smoothing operator that tends to preserve edges, since
an edge is also orthogonal to the gradient.
The second term of (68) represents a degenerate diffusion
in the direction of the local gradient. It is forward (smoothing)
if As(lVul) > 0, and backward (sharpening) if A2(IVuI) <
0. Since backward diffusion may be ill posed, there exist
possibilities that the whole system of (68) is ill posed if
X,(lVul) < 0 for some \Vu\ 20. This depends on the balance
between the forces represented by the first term of (68) and the 
YOU ef al.: ANISOTROPIC DIFFUSION 1547
Fig. 7.
noise.
Top: Original Lena image. Bottom: Degraded by IO-dB Gaussian
second term (where Xa(lVuI) < 0). If the force represented by
the first term dominates for all lVU 2 0, the system is well
posed. Otherwise, the system is ill posed and images close to
each other may diverge during the diffusion process.
B. Geometric Interpretation
Let us now give several geometric insights into the decomposition
(68). We will only outline the mathematical details
here referring the reader to [ 1 I] for a complete treatment.
First of all, we write (68) in the following form:
dt
where
Fig. 8.
t = 16. Middle: t = 128. Bottom: t = 4096.
Images processed by Perona and Malik‘s anisotropic diffusion. Top:
and
Note that n is precisely the mean curvature of the level sets of
n= up.,, - 2u,1f~yu,y + %L;U,, div (g) (72) the function u(x, y) [l], [12]. In fact, the evolution equation
(74)
is the level set evolution version of Euclidean curve shortening
in the plane that has been the object of much study recently
(U; + u33/2 dU
- = n1Vul
at
u;u,, + 2u,uyu,y + ,lL;u,,
I51 = (73) (U,; + u33/2 
1548 IEEE TRANSACTIONS ON IMAGE PROCESSING, VOL. 5, NO. 11, NOVEMBER 1996
also has a very natural interpretation, and in fact in a very
precise sense may be considered to be the dual to (74). In
order to make this point precise, we now recall the discussion
in the elegant paper of Evans [l 11.
Accordingly, we consider the following boundary-value
problem for the p-Laplacian:
div(IVu,Ip-2Vu,) =O in R, (76)
up =g on dR (77)
when 2 < p < CO. This is the Euler-Lagrange equation for
the variational problem of minimizing the energy
L(u2 + U:)” dx dy
over all sufficiently smooth functions obeying the given
boundary condition. (For the exact class of functions, see
1111.) Now assuming up is smooth and IVupl # 0, we may
rewrite (76) to read
1
Aup + D, = 0.
(P - 2)
Suppose we knew also that as p .--f CO, the functions up
converge in some sufficiently strong sense to a limit U. Then,
formally passing to limits in (78), we would expect u to solve
the partial differential equation
D, = nl/Vu) = 0. (79)
Accordingly, we define the m-Laplacian to be
becomes a Euler-Lagrange type equation for an Lm-norm type
“energy” minimization problem in the above sense. Given the
dual of L1 is Loo (under certain technical conditions) [28], the
dual operator of A, should be derived from the L1 version
of (76), which is precisely
Note that (80) and (81) are the steady-state versions of (74)
and (75). Thus, these arise from dual optimization problems.
Evans [ 111 notes that in general the equation A,u = 0 does
A, is degenerate, but only in the one direction normal to each
level set. On the other hand, the operator Am is nondegenerate
only in this direction. As we have seen, Alu = 0 is a
Fig. 9. Performance comparison of Rudin’s total variation-based diffusion not admit smooth Moreover, note that the operator
(top, 2 = 25), its modified version (middle, t = 25), and a new scheme
(bottom, t = 50).
“geometric” equation, since it says that the level sets of U have
A,u = 0 is strongly “nongeometric” or, rather, that all its
geometric information concerns not the level sets of U but
in mathematics and computer vision [l], [141-[161, l2O1, l2l1, pro-mean curvature. Thus, the partial differential equation [261, 1321, [331.
The equation
rather the curves normal to level sets. All of this is made
precise in the elegant paper of Evans [I 11. (75) 
YOU et al.: ANISOTROPIC DIFFUSION 1549
Fig. 10.
Gaussian noise.
Top: Original Cameraman image. Bottom: Degraded by 10-dB
v. EXAMPLES OF ILL-POSED AND
WELL-POSED ANISOTROPIC DIFFUSION
It is easy to show that the f’(.)’s for the two diffusion
coefficients (2) and (3) are
and S f’(4 = (83)
1+ (g
respectively, and both of them satisfy the condition (44), so
both of them are ill posed. The step images (33) seem to confirm
the staircasing effects observed in [36]. The orthogonal
decomposition of anisotropic diffusion described in Section
IV provides an insight into the smoothing and edge enhancing
property of the two anisotropic diffusion schemes as described
in [27]: The f”(.)’s of the two diffusion schemes have the
following thresholding property:
>O, x<T
<0, x>T (84)
Fig. 11. Top and middle: Cameraman image processed by Perona and
Malik’s anisotropic diffusion (t = 64 and 2048, respectively). Bottom:
Cameraman image processed by a proposed scheme (t = 64).
which, according to (68) and Fig. 3, indicates that the two
diffusion schemes smooth the image where the image gradient
is small and enhance it where the image gradient is large.
The line of research on noise removal based on bounded
variation can also be placed into the category of anisotropic
diffusion. The original algorithm considers the following constrained
minimization problem [29]: 
1550 IEEE TRANSACTIONS ON IMAGE PROCESSING, VOL. 5, NO. 11, NOVEMBER 1996
subject to
(86) 2 Iu - U01 = CT
where U,, is the observed image and 0’ is the power of observation
noise. If we ignore the constraint, (85) is exactly the
energy functional E(u) with a f(z) = z. The corresponding
diffusion coefficient is
It is easy to check that f’(z) = 1 and f”(z) = 0, so this
diffusion is well posed by the corollary to Theorem 4. Since
f”(x) 0, this diffusion scheme smooths an image only in
the direction orthogonal to the gradient, hence it tends not to
disturb edges. Note that the fact that f’(z) = 1 contradicts
the necessary condition (16) was not considered in [29].
However, this problem can be readily bypassed in practical
implementation by including the condition of “no diffusion
when lVul = 0,” which, in effect, forces the condition
f’(0) = 0 on the algorithm.
The above total variation-based algorithm tends to produce
“blocky effects” in smooth areas. This may be attributed to the
discontinuity of f’(z) at z = 0 and to the oversmoothing in
smooth areas because the diffusion coefficient ~(z) of (87) is
very large when x is very small. In order to treat this problem,
we modify the e(.) to
where T is a parameter to be selected for a particular application.
Such an f(.) incurs uniform diffusion wherever the
image gradient is small to effectively smooth out noise, while
keeping the edge-preserving property of the total variationbased
algorithm. Note that the second-order derivative f”(:c)
of such a e(.) is not continuous at x = T. This problem may
be dealt with by using the following:
- J(z - + b2 - b + &TZ? (89) f’(X) = -
2a
where a controls the range that f’(z) = z and b controls
the smoothness of the transition between f’(x) = z and
f’(z) = 1. An example of such a f(.) is shown in Fig. 4.
Of course, the remedies suggested above do not provide a
complete solution to the problem of lVul vanishing, and
further research will be needed to fully resolve the problem.
An extension of the total variation-based diffusion has been
proposed in [37], which can be further generalized to give a
f(z) = t > 0 and 0 <p < 1. (90)
Since f”(~) = p(p - 1)(~ + t)P-‘ < 0 for 0 < p < 1, this
diffusion scheme has backward diffusion to enhance edges.
Unfortunately, this diffusion scheme is ill posed because it
satisfies (U), as follows:f’(m) = limz--tm p(z + t)P--l = 0
for 0 < p < 1. Consequently, it should suffer from problems
associated with step images. Indeed, our simulation shows that
all input images are transformed into step images with many
false step edges. But what is interesting is that all the false
step edges gradually disappear as the diffusion proceeds, so
that fairly good performance has been observed in [37]. This
may be due to the discretization of the problem in digital
representation and processing.
This diffusion scheme also tends to produce “blocky effects”
in smooth areas because limz+o f’(z) = pF1 # 0 and we
have to redefine f’(0) = 0 as required by (16). This can be
relieved by modifying the diffusion coefficient e( .) into
which basically incurs uniform diffusion to avoid the “blocky
effects.”
Finally, we give an example that has backward diffusion
and does not satisfy the condition for step images
t>O and O<p<l. (92)
It can be verified that its j”(z) = p(p - 1)(z + t)PP2 < 0
for 0 < p < 1 and z > T, so it has backward diffusion to
enhance edges. It can also be verified that f’(m) = 1, so step
images are not its stationary points, according to Theorem 1.
Our simulation shows that staircasing effects still appear and
then disappear during the diffusion process, with the eventual
disappearance satisfying the requirement of Theorem 3.
VI. VECTOR-VALUED ANISOTROPIC DIFFUSION
The analysis given above basically can be extended for
vector-valued anisotropic diffusions, e.g., in color space. This
we plan to do in a future publication in which we will
discuss such diffusions in detail. In this paper, following
Whitaker-Gerig [35], we just want to indicate how anisotropic
diffusions may be extended in this framework.
Let uo:R + D be a vector-valued image where R c R”
and D c R” are open subsets. Then the vector-valued
anisotropic evolution equation has the form
dU
- = div (cVU) at (93)
where
VU =
and 
YOU ef al.: ANISOTROPIC DIFFUSION 1551
Of course, the key in making this type of diffusion interesting
is the choice of the diffusion coefficient c. We can,
of course, define independent diffusions in each channel,
but a much more interesting choice would be some sort of
coupling (this is called a dissimilarity operator in [35]) in
order to combine the information from the channels. A natural
nontrivial choice is
That is, we take the diffusion coefficient to be of the form
This operator is a straightforward generalization of the graylevel
image case (m = 1) and is also rotationally invariant.
One may, of course, also smooth the ut's via a Gaussian filter
as in (6).
We plan to apply our eigenvalue analysis to this multidimensional
case in a forthcoming paper as well as explicitly
apply the results to diffusions in color space.
VII. NUMERICAL SIMULATIONS
We now use numerical simulations to verify the theory just
developed and to illustrate some good anisotropic diffusion
schemes. The numerical techniques are based on hyperbolic
conservation laws and the theory of viscosity solutions [26],
[29], [33]. We follow [29] and discretize the anisotropic
diffusion (I) in the following manner:
at U?. + -
h
where At and h are the time step size and space grid size,
respectively, and
min(a, b), a > 0 and b > 0,
otherwise.
b), a < 0 and b < 0, (102)
A. Synthesized Image
Let us consider the following smooth sigmoid image:
X, y = 1,2, . . . 256.
255
U(z' ') = 1 + exp [-0.2(z - 128)] '
(803
We first use Perona and Malik's anisotropic diffusion scheme
(2) with kz = 100 to process this image. The left column of
Fig. 5 are the images generated by the anisotropic diffusion at
time t = 2", n = 0, 1, ... , 18. For each time t, a slice along
the x axis of the corresponding image is shown at the top of
Fig. 6. Since this diffusion scheme is ill-posed, step images are
developed and it does not disappear once it is fully developed.
Next, we run on the same sigmoid image the extended
version of the diffusion scheme developed by the authors in
[37] whose diffusion coefficient is given by (90) with p = 0.5
and E = 1. The corresponding results are shown in the middle
column of Fig. 5 and at the middle of Fig. 6. Since this
diffusion scheme is also ill posed, step images are developed.
But it is interesting that the step images gradually disappear so
that the smooth sigmoid edge is transformed into a step edge
and the step edge remains over many iterations.
Finally, we run the diffusion scheme given by (92) with
p = 0.5, E = I, and T = 0, and show the results in the night
column of Fig. 5 and at the bottom of Fig. 6. It is evident that
staircasing effects appear during the diffusion process, but they
disappear because step images are not its stationary points,
according to Theorem I. The difference of this one from the
above two diffusion schemes is that the step images appear
later and disappear faster. This behavior has been observed on
many images.
B. Natural Images
We consider two nkmerical experiments. In the first experiment,
the Lena image shown in Fig. 7 (top) is degraded to
give the image shown in Fig. 7 (bottom) using Gaussian noise
at a SNR = 10 dB, where
Variance of image
Variance of noise '
SNR = (104)
We first use Perona and Malik's diffusion (2) to process this
degraded image and show the results in Fig. 8, which clearly
indicate that this diffusion scheme is incapable of dealing with
noise. We then compare the performances of Rudin's total
variation-based diffusion (87), its modified version (88) with
T = 3, and the new scheme given by (91) with t = 1, p =: 0.5,
and T = 3. The images shown in Fig. 9 are what we judged
to be the best that the respective anisotropic diffusion schemes
can generate with respect to the diffusion time.
In the second experiment, the Cameraman image shown in
Fig. 10 (top) is degraded to give the image shown in Fig. 10
(bottom) using Gaussian noise at SNR = 10 dB. We first
employ the Perona and Malik diffusion (2) to process this
degraded image and show two of the processed images in the
top and middle of Fig. 11 (diffusion time t = 64 and 2048,
respectively) which, as before, indicate that this diffusion
scheme is incapable of dealing with noise. We then use the
new scheme given by (91) with E = 1, p = 0.5, and T = 
1552 IEEE TRANSACTIONS ON IMAGE PROCESSING, VOL. 5, NO. 11, NOVEMBER 1996
3. One of the processed images - is shown in the bottom of [23] F. Mokhatarian and A. Mackworth, “A theory of multiscale, curvatureFig.
11 (diffusion time t = 64).
VIII. CONCLUSIONS
In this paper, we have provided a behavioral analysis
of the anisotropic diffusion model of Perona and Malik.
The main idea was to express the equation as coming from
a certain optimization problem and find conditions for the
existence of a unique global minimum (well-posed diffusion)
and for the existence of infinitely many dense global minima
(ill-posed diffusion). In addition, the smoothing and edge
enhancement mechanism of anisotropic diffusion is illustrated
through an eigenvalue decomposition of the diffusion equation.
Moreover, we gave a natural geometric interpretation of this
decomposition and found that the two terms involved were
dual in a certain precise sense. As indicated above, we will
be extending these results to the vector case (in particular, to
color space) in the near future.
REFERENCES
L. Alvarez, P.-L. Lions, and J.-M. Morel, “Image selective smoothing
and edge detection by nonlinear diffusion 11,” SIAM Numer. Anal., vol.
29, no. 3, pp. 845-866, June 1992.
L. Alvarez. F. Guichard, P. L. Lions, and J. M. Morel, “Axiomatization
et nouveaux operateurs de la morphologie mathematique,” C. R. Acad.
Sci. Paris, vol. 315, pp. 265-268, 1992.
~, “Axiomes et equations fondamentales du traitement d’images,”
C. R. Acud. Sei. Paris, vol. 315, pp. 135-138, 1992.
S. Angeneut, “Parabolic equations for curves on surfaces, I: Curves with
p-integrable curvature,” Ann. Math., vol. 133, pp. 451483, 1990.
__, “Parabolic equations for curves on surfaces, 11: Intersections,
blow-up, and generalized solutions,” Ann. Math., vol. 133, pp. 171-215,
1991.
M. S. Bazaraa and C. M. Shetty, Nonlinear Programming: Theory and
Algorithms. New York: Wiley, 1979.
M. Bertero, T. A. Poggio, and V. Torre, “111-posed problems in early
vision,” Proc. IEEE, vol. 76, no. 8, pp. 869-889, Aug. 1988.
F. Catte, P.-L. Lions, J.-M. Morel, and T. Coll, “Image selective
smoothing and edge detection by nonlinear diffusion,” SIAM J. Num.
Anal., vol. 29, no. 1, pp. 182-193, Feb. 1992.
V. Caselles, F. Catte, T. Coll, and F. Dibos, “A geometric model for
active contours in image processing,” AMS, vol. 29, pp. 1-10, 1993.
M. G. Crandall, H. Ishii, and P. L. Lions, “Users guide to viscosity
solutions of second order partial linear differential equations,” Bull.
Amer. Math. Soc., vol. 27, pp. 1-67, 1992.
L. C. Evans, “Estimates for smooth absolutely minimizing Lipschitz
extensions,” Electron. J. Differen. Equat., vol. 1, pp. 1-9, 1993.
L. C. Evans and J. Spmck, “Motion of level sets by mean curvature, 1,”
J. DifSeren. Ceom., vol. 33, pp. 635-681, 1991.
L. Florack, “The syntactical structure of scalar images,” Ph.D. disserration,
Univ. Utrecht, The Netherlands, Nov. 1993.
M. Gage and R. S. Hamilton, “The heat equation shrinking convex plane
curves,” J. Differen. Geum., vol. 23, pp. 285-314, 1986.
M. Grayson, “The heat equation shrinks embedded plane curves to round
points,” J. Differen. Geom., vol. 26, pp. 285-314, 1987.
-, “Shortening embedded curves,” Ann. Math., vol. 129, pp.
71-111, 1989.
J. Hadamard, Lectures on the Cauchy Problem in Linear Partial Differential
Equations.
K. Hollig and J. A. Nohel, “A diffusion equation with a nonmonotone
constitutive function,” in Proc. Syst. Nonlinear Partial Differen.
Equation, J. Ball, Ed. Boston: D. Reidel, 1983, pp. 409-422.
S. Kichenassamy, “The Perona-Malik paradox,” Department of Mathematics,
Tech. Rep., Univ. Minnesota, Minneapolis, MN, 1996.
B. Kimia, A. Tannenbaum, and S. Zucker, “Toward a computational
theory of shape: An overview,” Tech. Rep. Cim-89-13, McGill Univ.,
Montreal, Canada, 1989.
-, “On the evolution of curves via a function of curvature I,” J.
Math. Anal. App., vol. 163, pp. 438-458, 1992.
R. J. LeVeque, Numerical Method for Conservation Laws. Basel,
Switzerland: Birkhauser, 1992.
New Haven: Yale Univ. Press, 1923.
based shape representation for planar curves,” IEEE Trans. Pattern Anal.
Machine Intell., vol. 14, pp. 789-805, 1992.
[24] A. W. Naylor and G. R. Sell, Linear Operator Theory in Engineering
and Science.
1251 M. Nitzberg and T. Shiota, “Nonlinear image filtering with edge and
corner enhancement,” IEEE Trans. Pattem Anal. Machine Intell., vol.
14, no. 8, pp. 826-833, Aug. 1992.
[26] S. J. Osher and J. A. Sethian, “Fronts propagating with curvature
dependent speed: Algorithms based on Hamilton-Jacobi formulations,”
J. Computat. Phys., vol. 79, pp. 1249, 1988.
[27] P. Perona and J. Malik, “Scale-space and edge detection using
anisotropic diffusion,” IEEE Trans. Pattern Anal. Machine Intell., vol.
12, no. 7, pp. 629-639, July 1990.
(281 W. Rudin, Real and Complex Analysis. New York: McGraw-Hill,
1966.
1291 L. I. Rudin, S. Osher, and E. Fatemi, “Nonlinear total variation based
noise removal algorithms,” Physica D 60, pp. 259-268, 1992.
[301 G. Sapiro and A. Tannenbaum, “Affine invariant scale-space,” Int. J.
Comput. Vision, no. 11.1, pp. 2544, 1993.
[3 11 J. A. Sethian, “An analysis of flame propagation,” Ph.D. dissertation,
Univ. Calif., Berkeley, June 1982.
[32] -, “Curvature and the evolution of fronts,” Commun. Math. Phys.,
vol. 101, pp. 487499, 1985.
[33] -, “A review of recent numerical algorithms for hypersurfaces
moving with curvature dependent speed,” J. Differen. Geom., vol. 31,
pp. 131-161, 1989.
[34] P. Smith, Convexity Methods in Variational Calculus. Letchworth,
England: Research Studies Press Ltd., 1985.
[35] R. T. Whitaker and G. Gerig, “Vector-valued diffusion,” in GeometryDriven
Diffusion in Computer Vision, Bart ter Haar Romeny, Ed.
Boston: Kluwer, 1994, pp. 93-134.
[36] R. T. Whitaker and S. M. Pizer, “A multi-scale approach to nonuniform
diffusion,” CVGIP: Image Understanding, vol. 57, no. 1, pp. 99-110,
Jan. 1993.
1371 Y.-L. You, M. Kaveh, Wenyuan Xu, and A. Tannenbaum, “Analysis and
design of anisotropic diffusion for image processing,” in Proc. IEEE Int.
Con$ Image Processing, vol. 11, Austin, TX, Nov. 1994, pp. 497-501.
New York: Springer-Verlag, 1982.
Yu-Li You received the B.S. and M.S degrees
in electronic engineering from Xidian university
(Northweatem Telecommunication Engineering Institute),
Xi’an, China, in 1985 and 1988. respec
tively, and the Ph D degree in electrical engineering
from the University of Minnesota, Minneapolis, in
1995.
He has been a senior software engineer with
Seagate Technology, Inc since 1995 His current
research interests include image and video compression,
image enhancement, image restoration, image
Dr. You received the 1990 Science and Technology Award from Gudngdong
analysis, communications, and neural networks
Provincial Government of China.
Wenyuan Xu graduated from the Department of
Mathematics, Nankai University, Tianjin. China,
in 1963, and received the PhD degree from the
University of Minnesota, Minneapolis, in 1993
From 1963 to 1979, he taught at Nankai Univer
rity From 1979 to 1990, he worked as a Research
Assistant Professor, a Research Associate Professor,
and a Research Professor, respectively, at the Institute
of Systems Science, Academa Sinica, Beijing,
China. From 1981 to 1983, and from 1986 to 1988,
he was a Visiting Scholar and Visiting Professor,
respectively, with the Department of Electrical Engineering, Polytechnic
Univercity, NY From 1993 to 1995, he was a Visiting Professor with
the Department of Electrical Engineering of the University of Minnesota
He is prevxtly with the 3M company in Minnesota. His primary research
interests are in signal processing, image processing, and statistical theory of
communication. 
YOU et al.: ANISOTROPIC DIFFUSION 1553
Allen Tannenbaum was born in New York City in
1953. He received the Ph.D. in mathematics from
Harvard University, Cambridge, MA, in 1976.
He has held faculty positions at the Weizmann In
stitnte of Science, McGill University, University of
Florida, ETH, Zunch, Switzerland, Technion-Israel
Institute of Technology, and Ben-Gurion University
of the Negev. He is presently Professor of Electrical
Engineering at the University of Minnesota, Minneapolis.
He has done research in robust control,
systems theory, computer vision, image processing,
robotics, semiconductor process control, operator theory, functional analysis,
algebraic geometry, and invariant theory. Dr. Tannenbaum has authored or
coauthored more than 170 research papers, and is the author or coauthor of
three books. lnbanance and Systems Theory, Feedback Control Theory (with
J Doyle and B. Francis), and Robust Control of Infinite Dimensional Systems
(with C. Foias and H. Ozbay). He also edited a volume with B. Francis (in
honor of George Zames) entitled Feedback Control, Nonlinear Systems, and
Complexity.
Mostafa Kaveh (S’73-M’75-SM’83-F’88) received
the B S. and Ph.D. degrees m electrical engineering
from Purdue Unlversity, West Lafayette,
IN, in 1969 and 1974, respectively, and the M1.S
degree from the University of California, Berkeley,
in 1970 He hap been at the University of Minnesota,
Minneapolis, since 1975, where he is presently a
Professor and Head of the Department of Electrical
Engineering.
Dr. Kaveh IS Vice President for Publications of
the IEEE Signal Processing Society and was the
General Chairman of ICASSP’93. He received a 1986 ASSP Senior (best
paper) Award (with A. Barabell) and the 1988 ASSP Meritorious Service
Award 